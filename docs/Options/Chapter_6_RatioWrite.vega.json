{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "background": "#f9f9f9",
    "description": "Ratio Call Write Profit vs Probability",
    "width": "container",
    "height": 320,
    "layer": [
        {
            "data": {
                "sequence": {
                    "start": 30,
                    "stop": 70,
                    "step": 0.5,
                    "as": "S"
                }
            },
            "transform": [
                {
                    "calculate": "14 * exp(-0.5 * pow((datum.S - 50) / 5, 2))",
                    "as": "probability_scaled"
                }
            ],
            "mark": {
                "type": "area",
                "color": "#cbd5e1",
                "opacity": 0.4,
                "interpolate": "monotone"
            },
            "encoding": {
                "x": {
                    "field": "S",
                    "type": "quantitative"
                },
                "y": {
                    "field": "probability_scaled",
                    "type": "quantitative",
                    "axis": null
                },
                "tooltip": [
                    {
                        "field": "S",
                        "title": "Stock Price"
                    },
                    {
                        "field": "probability_scaled",
                        "title": "Relative Probability",
                        "format": ".2f"
                    }
                ]
            }
        },
        {
            "data": {
                "values": [
                    {
                        "S": 37,
                        "profit": 0
                    },
                    {
                        "S": 40,
                        "profit": 3
                    },
                    {
                        "S": 49,
                        "profit": 12
                    },
                    {
                        "S": 50,
                        "profit": 13
                    },
                    {
                        "S": 60,
                        "profit": 3
                    },
                    {
                        "S": 63,
                        "profit": 0
                    },
                    {
                        "S": 70,
                        "profit": -7
                    }
                ]
            },
            "encoding": {
                "x": {
                    "field": "S",
                    "type": "quantitative",
                    "title": "Stock Price at Expiration ($)"
                },
                "y": {
                    "field": "profit",
                    "type": "quantitative",
                    "title": "Profit ($)"
                }
            },
            "layer": [
                {
                    "mark": {
                        "type": "area",
                        "color": "#94f0a6",
                        "opacity": 0.2
                    },
                    "transform": [
                        {
                            "filter": "datum.profit >= 0"
                        }
                    ]
                },
                {
                    "mark": {
                        "type": "area",
                        "color": "#ffc7ce",
                        "opacity": 0.2
                    },
                    "transform": [
                        {
                            "filter": "datum.profit <= 0"
                        }
                    ]
                },
                {
                    "mark": {
                        "type": "rule",
                        "color": "black"
                    },
                    "encoding": {
                        "y": {
                            "datum": 0
                        }
                    }
                },
                {
                    "mark": {
                        "type": "line",
                        "color": "#1f77b4"
                    }
                },
                {
                    "mark": {
                        "type": "point",
                        "filled": true,
                        "size": 80
                    },
                    "encoding": {
                        "color": {
                            "condition": [
                                {
                                    "test": "datum.profit > 0",
                                    "value": "#2ca02c"
                                },
                                {
                                    "test": "datum.profit < 0",
                                    "value": "#d62728"
                                }
                            ],
                            "value": "gray"
                        },
                        "tooltip": [
                            {
                                "field": "S",
                                "type": "quantitative",
                                "title": "Stock Price"
                            },
                            {
                                "field": "profit",
                                "type": "quantitative",
                                "title": "Profit"
                            }
                        ]
                    }
                },
                {
                    "mark": {
                        "type": "rule",
                        "color": "gray",
                        "strokeDash": [
                            4,
                            2
                        ]
                    },
                    "encoding": {
                        "x": {
                            "datum": 50
                        },
                        "opacity": {
                            "value": 0.5
                        }
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "align": "left",
                        "dx": 5,
                        "dy": -10,
                        "text": "Peak Probability"
                    },
                    "encoding": {
                        "x": {
                            "datum": 50
                        },
                        "y": {
                            "datum": 14
                        }
                    }
                }
            ]
        }
    ]
}